services:

  apache:
    build: docker/apache        #build image from the Dockerfile located at this path
    ## user: "1000:1000" //did not help with permissions issue
    container_name: apache-endstation
    ports:
      - "80:80"
    volumes:
      - ./:/var/www/endstation
    env_file:
      - .env

  mariadb:
    image: mariadb:latest   #just use the base image
    container_name: mariadb #also works as a hostname in php, and Docker handles name resolution to the container where the service is currently running
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
      MYSQL_DATABASE: ${DB_NAME_MAIN}
      MYSQL_USER: ${DB_USER}
      MYSQL_PASSWORD: ${DB_PASSWORD}
      MYSQL_INNODB_BUFFER_POOL_SIZE: 512M
      MYSQL_TMP_TABLE_SIZE: 256M
      MYSQL_MAX_HEAP_TABLE_SIZE: 256M
      MYSQL_MAX_CONNECTIONS: 200
      MYSQL_MAX_EXECUTION_TIME: 0
      MYSQL_INNODB_LOCK_WAIT_TIMEOUT: 300
      MYSQL_WAIT_TIMEOUT: 86400
      MYSQL_INTERACTIVE_TIMEOUT: 86400
      MYSQL_NET_READ_TIMEOUT: 600
      MYSQL_NET_WRITE_TIMEOUT: 600
      MYSQL_GROUP_CONCAT_MAX_LEN: 10000000
    ports:
      - "3306:3306"
    restart: always
    volumes:
     - mariadb_data:/var/lib/mysql
     - ./docker/mariadb/init.sql:/docker-entrypoint-initdb.d/init.sql #path in the container where MariaDB looks for init scripts

  adminer:
    image: adminer         #just use the base image
    restart: always
    ports:
     - "8080:8080"

volumes:
  mariadb_data:           #can re-use same name in different projects - Docker prepends project name to the volume